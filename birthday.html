<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Secret Gate</title>
    <style>
        /* === 基础样式 === */
        *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}
        body{height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;background:#111;}

     
       /* === 1. 验证码页 === */
#captchaPage{
    display:flex;
    flex-direction:column;
    align-items:center;
    width:280px;
    padding:40px 20px;
    background:#e8f5e9;                /* 青瓷浅绿背景 */
    border-radius:20px;
    box-shadow:0 0 30px rgba(0,121,107,.25);
    animation:float 3s ease-in-out infinite;
}
#captchaPage h2{
    font-size:22px;
    margin-bottom:20px;
    color:#00796b;                    /* 青瓷深文字 */
    letter-spacing:1px;
}
#captchaInput{
    width:100%;
    padding:12px 15px;
    border:2px solid #4db6ac;         /* 青瓷中边框 */
    border-radius:30px;
    outline:none;
    font-size:16px;
    text-align:center;
    transition:.3s;
}
#captchaInput:focus{
    border-color:#00796b;
    box-shadow:0 0 0 3px rgba(77,182,172,.3);
}
#captchaBtn{
    margin-top:20px;
    padding:10px 30px;
    background:linear-gradient(135deg,#00796b,#26a69a);
    color:#fff;
    border:none;
    border-radius:30px;
    cursor:pointer;
    font-size:16px;
    transition:.3s;
}
#captchaBtn:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 15px rgba(38,166,154,.4);
}
#captchaError{color:#d32f2f;font-size:14px;margin-top:10px;height:20px;}

/* === 2. 右下角椭圆按钮 === */
#doneBtn{
    position:absolute;
    bottom:30px;
    right:30px;
    background:#00796b;
    color:#fff;
    border:none;
    padding:14px 30px;
    border-radius:50px;
    font-size:16px;
    cursor:pointer;
    box-shadow:0 4px 15px rgba(0,121,107,.4);
    transition:.3s;
}
#doneBtn:hover{
    transform:translateY(-3px);
    box-shadow:0 6px 20px rgba(0,121,107,.5);
}

/* === 3. 确认弹窗按钮 === */
#confirmBtn{
    background:linear-gradient(135deg,#00796b,#26a69a);
    color:#fff;
}
#confirmBtn:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 15px rgba(38,166,154,.4);
}
        #confirmBox p{font-size:18px;margin-bottom:25px;color:#333;}
        #confirmBox button{
            border:none;
            padding:10px 28px;
            margin:0 12px;
            border-radius:30px;
            font-size:16px;
            cursor:pointer;
            transition:.3s;
        }
        #cancelBtn{background:#e0e0e0;color:#333;}
        #confirmBtn{background:linear-gradient(135deg,#ff4081,#ff6090);color:#fff;}
        #cancelBtn:hover{background:#bdbdbd;}
        #confirmBtn:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(255,64,129,.4);}
        @keyframes pop{0%{transform:scale(.85);opacity:0;}100%{transform:scale(1);opacity:1;}}

        /* === 通用动画 === */
        @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
        @keyframes fadeIn{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
    </style>
</head>
<body class="noDev">

    <!-- 验证码页 -->
    <div id="captchaPage">
        <h2>请输入通行密码</h2>
        <input id="captchaInput" type="text" placeholder="4 位密码" maxlength="4"/>
        <button id="captchaBtn">确认</button>
        <div id="captchaError"></div>
    </div>

    <!-- 卡片页 -->
    <div id="cardPage">
        <div id="cardText">你找到了钥匙
接下来的每一步
都由你亲自书写
准备好了吗？</div>
        <svg id="nextIcon" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87L17.18 22 12 18.77 6.82 22 7 14.14 2 9.27l6.91-.01L12 2z"/>
        </svg>
    </div>

    <!-- 输入页 -->
    <div id="inputPage">
        <textarea class="input-box" id="textInput" placeholder="把你想说的都写下来吧……"></textarea>
        <button id="doneBtn">我写完啦</button>
    </div>

    <!-- 确认弹窗 -->
    <div id="confirmMask">
        <div id="confirmBox">
            <p>真的写完了？</p>
            <button id="cancelBtn">手滑了</button>
            <button id="confirmBtn">是的</button>
        </div>
    </div>

    <script>
        /* ========= 配置 ========= */
        const REAL_CODE = 'Z9K3';     // 改动点：验证码

        /* ========= 防后退/刷新 ========= */
        history.pushState(null,null,location.href);
        window.onpopstate=()=>history.go(1);
        window.onbeforeunload=()=>'';

        /* ========= 验证码逻辑 ========= */
        document.getElementById('captchaBtn').onclick=()=>{
            const val=document.getElementById('captchaInput').value.toUpperCase();
            if(val===REAL_CODE){
                document.getElementById('captchaPage').style.display='none';
                document.getElementById('cardPage').style.display='flex';
            }else{
                document.getElementById('captchaError').textContent='密码错误';
                document.getElementById('captchaInput').value='';
            }
        };

        /* ========= 卡片页 → 输入页 ========= */
        document.getElementById('nextIcon').onclick=()=>{
            document.getElementById('cardPage').style.display='none';
            document.getElementById('inputPage').style.display='flex';
            document.getElementById('textInput').focus();
            createBubbles();
        };

        /* ========= 气泡装饰 ========= */
        function createBubbles(){
            for(let i=0;i<20;i++){
                setTimeout(()=>{
                    const b=document.createElement('span');
                    b.className='bubble';
                    const size=Math.random()*60+20;
                    b.style.width=b.style.height=size+'px';
                    b.style.left=Math.random()*100+'%';
                    b.style.animationDuration=(Math.random()*2+6)+'s';
                    document.getElementById('inputPage').appendChild(b);
                    setTimeout(()=>b.remove(),8000);
                },i*400);
            }
        }

        /* ========= “我写完啦” 按钮 & 确认面板 ========= */
        const doneBtn=document.getElementById('doneBtn');
        const confirmMask=document.getElementById('confirmMask');
        const cancelBtn=document.getElementById('cancelBtn');
        const confirmBtn=document.getElementById('confirmBtn');
        const textInput=document.getElementById('textInput');

        doneBtn.onclick=()=>confirmMask.style.display='flex';
        cancelBtn.onclick=()=>confirmMask.style.display='none';

        /* ========= 改动点：上传到服务器 ========= */
        confirmBtn.onclick=()=>{
            const content=textInput.value;
            if(!content.trim()){alert('写点东西再提交吧');return;}
            fetch('save.php',{          // 改动点：后端接口
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({data:content})
            })
            .then(r=>r.text())
            .then(msg=>{alert(msg);confirmMask.style.display='none';})
            .catch(err=>{alert('上传失败：'+err);});
        };

        /* ========= 防调试 ========= */
        document.addEventListener('contextmenu',e=>e.preventDefault());
        document.addEventListener('keydown',e=>{
            if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&e.key==='I')||(e.ctrlKey&&e.key==='u'))e.preventDefault();
        });
    </script>
</body>

</html>
